server.modules += ("mod_openssl")

$SERVER["socket"] == "0.0.0.0:443" {
	ssl.engine  = "enable"
  ssl.privkey = "/etc/ssl/private/pihole.key"
	ssl.pemfile = "/etc/ssl/certs/pihole.key"
}
$SERVER["socket"] == "[::]:443" {
	ssl.engine  = "enable"
  ssl.privkey = "/etc/ssl/private/pihole.key"
	ssl.pemfile = "/etc/ssl/certs/pihole.key"
}

# Redirect HTTP to HTTPS
$HTTP["scheme"] == "http" {
    $HTTP["host"] =~ ".*" {
        url.redirect = (".*" => "https://%0$0")
    }
}
